<div class="sfondoBlu">
<div class="container sfondoBlu">
    <div class="row">
    <div id="prodotto-div" class="row js_prodotto_cards">
        
        <!--Form per acquistare-->
        <div>
       </div>
     </div>
    </div>

    </div>
</div>


@section Scripts {

    <script type="text/javascript">

      dettaglioElemento();
            console.log("Sono arrivato qui");
        function dettaglioElemento(){
            var url = window.location.pathname;
            var id = url.substring(url.lastIndexOf('/') + 1);
            console.log(id);
            axios.get('/api/Prodotti/GetId/' + id ).then((result) =>
                {
                // Codice che verrà eseguito quando arrivano i dati dalla mia web api
                console.log("Ho ricevuto il prodotto da visualizzare");
                       document.getElementById('prodotto-div').innerHTML += 
                            `
                            <div class="container">
                            <div class="row">
                            <div class="col-md-12 col-4 p-2 text-center">
                            <div class=" sfondoGiallo bg-opacity-10 border border-info  rounded-start rounded-end">
                             <h5 class="title mt-2">${result.data.nome}</h5>
                            </div>
                            </div>
                            </div>
                            <div class="row">
                            <div class="col-6 mb-2">
                              <img id="myimage" src="${result.data.immagine}" style=" height: 500px; width: 500px;" Class="border border-2 border-warning rounded" alt="${result.data.descrizione}">
                            </div>
                            <div class="col-md-6 col-4 p-2">
                            <div class="p-3 sfondoGiallo bg-opacity-10 border border-info border-start-0 rounded-start">
                            <p class="text"> Descrizione: </p>
                            <p class="text my-2">${result.data.descrizione}</p>
                             <p class="text"> Costo: </p>
                            <p class="text my-2">${result.data.prezzo} €</p>


                            <form onsubmit="Acquisto(event)"  method="post">
                                <div class="form-group col-md-6 col-12">
                                            <label>Quantita da acquistare</label>
                                            <input type="text" class="d-block w-100" id="Quantita" placeholder="Inserisci un numero">
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="form-group col-12 text-center">
                                        <button type="submit" class="btn btn-primary btn-block mb-4">Invia acquisto</button>
                                   </div>
                                </div>
                            </form>


                            </div>
                             </div>
                            </div>
                           </div>                          
                            `
             }).catch((error) => {
                console.log("C'è stato un errore: " + error);
            });
        }


                //Funzione per il form
            function Acquisto(event)
            {
                    event.preventDefault();
                            var url = window.location.pathname;
                            var idBox = url.substring(url.lastIndexOf('/') + 1);
                            var formatoData = moment().format();
                            var quantita = document.getElementById('Quantita').value; 
                            var id = idBox;
                                var acquistoUtente = {
                                  Data: formatoData,
                                  QuantitaDaAcquistare: quantita,
                                  ProdottoId: id,
                                  Prodotti: null
                              }
                axios.post('/api/AcquistoUtente/post',  acquistoUtente
                ).then((result) => {
                          
                    alert("Complimenti hai acquistato il prodotto");
                }).catch((error) => {
                    console.log("C'è stato un errore: " + error);
                    console.log(acquistoUtente)
                });
            }
           


    </script>

}
